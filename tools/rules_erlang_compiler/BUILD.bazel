load("//:erlang_app.bzl", "erlang_app", "test_erlang_app")
load("//:escript.bzl", "escript_archive", "escript_wrapper")

APP_NAME = "rules_erlang_compiler"

APP_VERSION = "1.0.0"

EXTRA_APPS = [
    "crypto",
]

DEPS = [
    "//tools/erl_attrs_to_json:erlang_app",
    "@thoas_rules_erlang//:erlang_app",
]

erlang_app(
    name = "erlang_app",
    app_name = APP_NAME,
    app_version = APP_VERSION,
    extra_apps = EXTRA_APPS,
    deps = DEPS,
)

test_erlang_app(
    name = "test_erlang_app",
    app_name = APP_NAME,
    app_version = APP_VERSION,
    extra_apps = EXTRA_APPS,
    deps = DEPS,
)

escript_archive(
    name = APP_NAME,
    app = ":erlang_app",
)

escript_wrapper(
    name = "wrapper",
    escript = ":%s" % APP_NAME,
    out = "wrapper.bash",
    visibility = ["//visibility:public"],
)
